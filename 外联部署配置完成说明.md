# ✅ 外联 Tomcat 部署配置完成

## 🎉 修改完成

您的项目已成功从 **嵌入式 Tomcat** 配置转换为 **外联 Tomcat** 部署方式，可以在 IntelliJ IDEA 中正常运行了！

---

## 📋 已完成的修改

### ✅ 1. 移除嵌入式 Tomcat 依赖

-   **文件**: `pom.xml`
-   **修改**: 移除了 3 个嵌入式 Tomcat 依赖包
    -   `tomcat-embed-core`
    -   `tomcat-embed-jasper`
    -   `tomcat-embed-el`

### ✅ 2. 删除嵌入式启动类

-   **删除文件**: `src/main/java/tarot/TarotGameApplication.java`
-   **原因**: 该类仅用于嵌入式 Tomcat 启动，外联部署不再需要

### ✅ 3. 保留的核心依赖

-   ✅ Jakarta Servlet API 6.1.0 (scope: provided)
-   ✅ Jackson 2.18.0 (JSON 处理)
-   ✅ SLF4J + Logback (日志框架)
-   ✅ JUnit 5 (测试框架)

### ✅ 4. 验证结果

-   ✅ Maven 编译成功
-   ✅ WAR 包打包成功
-   ✅ 文件位置: `target/tarot.war`

---

## 🚀 下一步：在 IntelliJ IDEA 中配置

### 📖 详细配置指南

请查看完整的配置文档：**[IDEA_TOMCAT_CONFIG.md](IDEA_TOMCAT_CONFIG.md)**

### ⚡ 快速配置步骤

#### 1️⃣ 添加 Tomcat 服务器

1. **File → Settings → Application Servers**
2. 添加 **Tomcat 11.0.11**
3. Tomcat Home: `C:\Users\35600\Desktop\tlp\apache-tomcat-11.0.11`

#### 2️⃣ 配置 Run/Debug Configuration

1. 添加 **Tomcat Server → Local**
2. **Server**选项卡:
    - 选择 Tomcat 11.0.11
    - 端口: 8080
    - URL: `http://localhost:8080/tarot/`
3. **Deployment**选项卡:
    - 添加 **tarot:war exploded**
    - Application context: `/tarot`

#### 3️⃣ 运行项目

-   点击 **▶️ Run** 或 **🐛 Debug**
-   等待自动部署
-   浏览器自动打开 `http://localhost:8080/tarot/`

---

## 📁 项目结构（已更新）

```
tlp/
├── src/main/
│   ├── java/tarot/
│   │   ├── controller/          ✅ Web控制器
│   │   ├── service/             ✅ 业务服务
│   │   ├── model/               ✅ 数据模型
│   │   ├── data/                ✅ 数据源
│   │   ├── listener/            ✅ 监听器
│   │   ├── Main.java            ✅ 测试类
│   │   └── SimpleTarotTest.java ✅ 测试类
│   └── webapp/
│       ├── WEB-INF/web.xml      ✅ Web配置
│       ├── css/                 ✅ 样式
│       ├── js/                  ✅ 脚本
│       └── index.html           ✅ 主页
├── apache-tomcat-11.0.11/       ✅ 外部Tomcat
├── target/
│   └── tarot.war                ✅ 打包文件
├── pom.xml                      ✅ 已更新（移除嵌入式依赖）
├── IDEA_TOMCAT_CONFIG.md        ✅ 新增配置指南
├── README.md                    ✅ 已更新
└── CONFIGURATION.md             ✅ 已更新
```

---

## 🎯 验证部署

### 方式一：IDEA 运行（推荐）

配置完成后，直接在 IDEA 中运行

### 方式二：命令行部署

```bash
# 1. 复制WAR包到Tomcat
copy target\tarot.war apache-tomcat-11.0.11\webapps\

# 2. 启动Tomcat
apache-tomcat-11.0.11\bin\startup.bat

# 3. 访问应用
# http://localhost:8080/tarot/
```

### 验证 URL

-   ✅ 主页: http://localhost:8080/tarot/
-   ✅ API: http://localhost:8080/tarot/api/cards
-   ✅ 大阿卡纳: http://localhost:8080/tarot/api/major-arcana

---

## 🔧 常见问题解决

### Q1: IDEA 找不到 Tomcat 配置？

**A**: 确保使用 **IntelliJ IDEA Ultimate** 版本（社区版不支持 Tomcat 集成）

### Q2: 部署后 404 错误？

**A**: 检查 Application context 是否设置为 `/tarot`

### Q3: 类找不到错误？

**A**:

1. Build → Rebuild Project
2. 确保 Artifacts 包含所有依赖 jar

### Q4: 中文乱码？

**A**:

1. Settings → File Encodings → 全部 UTF-8
2. Help → Edit Custom VM Options → 添加 `-Dfile.encoding=UTF-8`

---

## 📝 开发提示

### Maven 命令

```bash
# 清理编译
mvn clean compile

# 打包（跳过测试）
mvn package -DskipTests

# 查看依赖树
mvn dependency:tree
```

### IDEA 快捷键

-   **Ctrl + F10**: 更新应用（热部署）
-   **Shift + F10**: 运行
-   **Shift + F9**: 调试

---

## 📚 相关文档

| 文档                                           | 说明                     |
| ---------------------------------------------- | ------------------------ |
| [IDEA_TOMCAT_CONFIG.md](IDEA_TOMCAT_CONFIG.md) | IDEA+Tomcat 完整配置指南 |
| [README.md](README.md)                         | 项目使用说明             |
| [CONFIGURATION.md](CONFIGURATION.md)           | 技术配置文档             |

---

## ✨ 优势对比

### ⚡ 外联部署的优势

-   ✅ 更符合企业开发规范
-   ✅ IDEA 原生支持，调试方便
-   ✅ 热部署支持更好
-   ✅ 可以断点调试
-   ✅ 资源占用更小
-   ✅ 更接近生产环境

### 🔄 vs 嵌入式部署

| 特性     | 外联部署   | 嵌入式部署 |
| -------- | ---------- | ---------- |
| IDE 支持 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐     |
| 调试体验 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐     |
| 热部署   | ⭐⭐⭐⭐⭐ | ⭐⭐       |
| 启动速度 | ⭐⭐⭐⭐   | ⭐⭐⭐⭐   |
| 配置难度 | ⭐⭐⭐     | ⭐⭐⭐⭐⭐ |

---

**🎊 配置完成！现在可以在 IDEA 中愉快地开发调试了！** 🚀

如有问题，请参考 [IDEA_TOMCAT_CONFIG.md](IDEA_TOMCAT_CONFIG.md) 中的详细说明。
