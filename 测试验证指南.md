# 404错误修复验证指南

## 修复内容总结

已修复的关键问题：
1. ✅ JavaScript API路径适配应用上下文
2. ✅ pom.xml路径分隔符标准化

## 验证步骤

### 步骤1：重新编译和打包

```bash
# 在项目根目录执行
mvn clean package
```

**预期结果**：
```
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: XX.XXX s
[INFO] Finished at: YYYY-MM-DDTHH:mm:ss
```

### 步骤2：部署到Tomcat

```bash
# 复制WAR文件到Tomcat
cp target/tarot.war apache-tomcat-11.0.11/webapps/

# 如果Tomcat正在运行，它会自动部署
# 如果Tomcat未运行，启动它
cd apache-tomcat-11.0.11/bin
./startup.sh    # Linux/Mac
# 或
startup.bat     # Windows
```

**检查部署日志**：
```bash
tail -f apache-tomcat-11.0.11/logs/catalina.out
```

应该看到类似信息：
```
信息 [main] org.apache.catalina.startup.HostConfig.deployWAR 
正在部署web应用程序存档文件[.../webapps/tarot.war]
...
信息 [main] org.apache.catalina.startup.HostConfig.deployWAR 
web应用程序存档文件[.../webapps/tarot.war]的部署已在[XXX]ms内完成
```

### 步骤3：浏览器测试

1. **访问应用首页**：
   ```
   http://localhost:8080/tarot/
   ```
   
   **预期结果**：
   - 页面正常加载
   - 显示"塔罗解惑"标题
   - 显示卡牌选择界面

2. **打开浏览器开发者工具（F12）**：
   - 切换到 **Network（网络）** 标签
   - 刷新页面

3. **检查关键请求**：

   | 请求 | 状态码 | 说明 |
   |------|-------|------|
   | `/tarot/` | 200 | 首页HTML |
   | `/tarot/css/tarot-styles.css` | 200 | 样式表 |
   | `/tarot/js/tarot-game.js` | 200 | JavaScript |
   | `/tarot/api/cards` | 200 | **关键：API调用** |
   | `/tarot/images/卡牌背面.png` | 200 | 图片资源 |

   **重点检查 `/tarot/api/cards`**：
   - 状态码必须是 **200**
   - 响应类型：`application/json`
   - 响应内容应包含塔罗牌数据

4. **检查Console（控制台）标签**：
   - 不应有红色错误信息
   - 可以忽略关于 `/@vite/client` 的404（开发工具残留）

### 步骤4：功能测试

1. **卡牌加载测试**：
   - 页面应显示20张卡牌背面
   - 卡牌应以扇形排列

2. **拖拽测试**：
   - 鼠标按住任意卡牌
   - 拖动到顶部的三个放置区域之一
   - 释放鼠标
   - **预期**：卡牌应正确放置并显示牌名

3. **占卜测试**：
   - 依次选择3张卡牌
   - **预期**：自动跳转到解读结果页面
   - 显示选中的3张牌及其含义

4. **重置测试**：
   - 点击"再次占卜"按钮
   - **预期**：返回选择界面，卡牌重新洗牌

## 常见问题排查

### 问题1：页面仍然404

**检查**：
```bash
# 确认WAR文件已部署
ls -l apache-tomcat-11.0.11/webapps/
# 应该看到 tarot.war 和 tarot/ 目录

# 检查Tomcat是否在运行
ps aux | grep tomcat
# 或
netstat -an | grep 8080
```

**解决方案**：
- 确保Tomcat已启动
- 检查端口8080未被占用
- 重新部署：删除 `webapps/tarot/` 和 `tarot.war`，重新复制WAR文件

### 问题2：API调用404

**检查浏览器Console**：
```javascript
// 在浏览器Console中执行，检查API路径
console.log(window.location.pathname);
// 应输出：/tarot/ 或 /tarot/xxx

// 检查构建的API URL
const contextPath = window.location.pathname.substring(0, window.location.pathname.indexOf('/', 1)) || '';
console.log(`${contextPath}/api/cards`);
// 应输出：/tarot/api/cards
```

**检查Tomcat日志**：
```bash
tail -100 apache-tomcat-11.0.11/logs/localhost.2025-10-17.log
```

查找：
- `TarotGameController` 相关的日志
- 任何异常或错误信息

### 问题3：功能不正常但无404

**检查浏览器Console**：
- 查看是否有JavaScript错误
- 查看是否有CORS或其他网络错误

**检查后端日志**：
```bash
tail -100 apache-tomcat-11.0.11/logs/catalina.out
```

## 成功标准

✅ **部署成功的标志**：
1. 访问 `http://localhost:8080/tarot/` 显示正常页面
2. Network标签中 `/tarot/api/cards` 返回200
3. 能看到20张卡牌背面
4. 能拖拽卡牌到放置区域
5. 选择3张牌后能看到解读结果

## 需要帮助？

如果问题仍然存在，请提供：
1. 浏览器Console的完整错误信息
2. Network标签中失败请求的详细信息
3. Tomcat日志中的相关错误

---
**文档更新**：2025-10-17
